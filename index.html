<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Sportovní tým</title>
    <script>
        const HOST = window.location.protocol + "//" + window.location.hostname + ((window.location.port) ? ":" + window.location.port : "");

        function ukazChybu(e) {
            console.error('Error:', e.toString());
            let s;
            if (typeof e == "object") {
                s = JSON.stringify(e);
            } else {
                s = e;
            }
            //alert(s);
            document.getElementById("div_chyby").innerHTML = `<input type="button" value="x" onclick="document.getElementById('div_chyby').style.display = 'none'"> ${s}`;
            document.getElementById("div_chyby").style.display = 'block';
        }

        function ulozHrace() {
            let url = `${HOST}/db/pridejHrace?`;
            if (edit_id) {
                url = `${HOST}/db/ulozHrace?id=${edit_id}`;
            }
            url += "&dres="  + document.getElementById("cislo_dresu").value;
            url += "&jmeno=" + document.getElementById("jmeno").value;
            url += "&prijmeni=" + document.getElementById("prijmeni").value;
            url += "&roknar=" + document.getElementById("rok_narozeni").value;
            fetch(url).then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    if (obj.error) {
                        document.getElementById("div_hraci").innerHTML = obj.error;
                    } else {
                        dbHraci();
                    }
                }).catch((error) => {
                    ukazChybu(error);
                });
            });
        }
        let edit_id; //id editovaneho hrace
        function upravitHrace(id, dres, jmeno, prijmeni, roknar) {
            edit_id = id;
            document.getElementById("cislo_dresu").value = dres;
            document.getElementById("jmeno").value = jmeno;
            document.getElementById("prijmeni").value = prijmeni;
            document.getElementById("rok_narozeni").value = roknar;

        }
        function stornoHrace() {
            edit_id = undefined;
            document.getElementById("cislo_dresu").value = "";
            document.getElementById("jmeno").value = "";
            document.getElementById("prijmeni").value = "";
            document.getElementById("rok_narozeni").value = "";
        }
        function dbHraci() {
            document.getElementById("jmeno").value = "";
            document.getElementById("prijmeni").value = "";
            let url = `${HOST}/db/hraci?`;
            fetch(url).then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    if (obj.error) {
                        document.getElementById("div_hraci").innerHTML = obj.error;
                    } else {
                        let s = ``;
                        for (let st of obj.hraci) {
                            s += `<a href="JavaScript:upravitHrace(${st.id},${st.cislo_dresu},'${st.jmeno}','${st.prijmeni}',${st.rok_narozeni})">#${st.cislo_dresu} ${st.jmeno} ${st.prijmeni} (${st.rok_narozeni}) </a><br>`;
                        }
                        document.getElementById("div_hraci").innerHTML = s;
                    }
                }).catch((error) => {
                    ukazChybu(error);
                });
            });
        }

        function ukazTym() {
            document.getElementById("div_tym").style.display = "block";
            document.getElementById("div_zapasy").style.display = "none";
            document.getElementById("div_zapas").style.display = "none";
        }
        function ukazZapasy() {
            document.getElementById("div_tym").style.display = "none";
            document.getElementById("div_zapasy").style.display = "block";
            document.getElementById("div_zapas").style.display = "none";
        }
        function ukazZapas(id) {
            document.getElementById("div_tym").style.display = "none";
            document.getElementById("div_zapasy").style.display = "none";
            document.getElementById("div_zapas").style.display = "block";
        }
        function spustPoNacteni() {
            ukazTym();
            dbHraci();
        }

    </script>
</head>
<body onload="spustPoNacteni()">

<div id="div_chyby" style="color: white; background-color: red; display: none"></div>

<!-- ***** Tym ***** -->
<div id="div_tym">
    <div style="position:fixed;right:40px;"><button style="alignment: right" onclick="ukazZapasy()">Zápasy</button></div>
    <h1>Tým</h1>

    #<input type="number" id="cislo_dresu" placeholder="dres" min="1" max="99">
    <input type="text" id="jmeno" placeholder="jméno">
    <input type="text" id="prijmeni" placeholder="příjmení">
    <input type="number" id="rok_narozeni" placeholder="narozen(a)" min="1900" max="2020">
    <input type="button" value="Uložit" onclick="ulozHrace()">
    <input type="button" value="Storno" onclick="stornoHrace()">
    <div id="div_hraci"></div>

</div>

<!-- ***** Zapasy ***** -->
<div id="div_zapasy">
    <div style="position:fixed;right:40px;"><button style="alignment: right" onclick="ukazTym()">zpět na Tým</button></div>
    <h1>Zápasy</h1>

</div>

<!-- ***** Zapas ***** -->
<div id="div_zapas">
    <div style="position:fixed;right:40px;"><button style="alignment: right" onclick="ukazZapasy()">zpět na Zápasy</button></div>
    <h1>Zápas</h1>

</div>

</body>
</html>
