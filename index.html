<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Sportovní tým</title>
    <script>
        const HOST = window.location.protocol + "//" + window.location.hostname + ((window.location.port) ? ":" + window.location.port : "");

        function ukazChybu(e) {
            console.error('Error:', e.toString());
            let s;
            if (typeof e == "object") {
                s = JSON.stringify(e);
            } else {
                s = e;
            }
            //alert(s);
            document.getElementById("div_chyby").innerHTML = `<input type="button" value="x" onclick="document.getElementById('div_chyby').style.display = 'none'"> ${s}`;
            document.getElementById("div_chyby").style.display = 'block';
        }

        //*******************************************************
        //***** Tym *********************************************
        //*******************************************************
        function dbUlozHrace() {
            let url = `${HOST}/hraci/pridej?`;
            if (edit_id) {
                url = `${HOST}/hraci/uloz?id=${edit_id}`;
            }
            url += "&dres="  + document.getElementById("cislo_dresu").value;
            url += "&jmeno=" + document.getElementById("jmeno").value;
            url += "&prijmeni=" + document.getElementById("prijmeni").value;
            url += "&roknar=" + document.getElementById("rok_narozeni").value;
            fetch(url).then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    if (obj.error) {
                        document.getElementById("div_hraci").innerHTML = obj.error;
                    } else {
                        dbNactiTym();
                    }
                }).catch((error) => {
                    ukazChybu(error);
                });
            });
        }
        let edit_id; //id editovaneho hrace
        function upravitHrace(id, dres, jmeno, prijmeni, roknar) {
            edit_id = id;
            document.getElementById("cislo_dresu").value = dres;
            document.getElementById("jmeno").value = jmeno;
            document.getElementById("prijmeni").value = prijmeni;
            document.getElementById("rok_narozeni").value = roknar;

        }
        function stornoHrace() {
            edit_id = undefined;
            document.getElementById("cislo_dresu").value = "";
            document.getElementById("jmeno").value = "";
            document.getElementById("prijmeni").value = "";
            document.getElementById("rok_narozeni").value = "";
        }
        function dbNactiTym() {
            stornoHrace(); //vycisteni vstupnich poli
            let url = `${HOST}/hraci/`;
            fetch(url).then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    if (obj.error) {
                        document.getElementById("div_hraci").innerHTML = obj.error;
                    } else {
                        let s = ``;
                        for (let st of obj.hraci) {
                            s += `<a href="JavaScript:upravitHrace(${st.id},${st.cislo_dresu},'${st.jmeno}','${st.prijmeni}',${st.rok_narozeni})">#${st.cislo_dresu} ${st.jmeno} ${st.prijmeni} (${st.rok_narozeni})</a>`;
                            s += ` Z:${st.z} G:${st.g} A:${st.a} <br>`;
                        }
                        document.getElementById("div_hraci").innerHTML = s;
                    }
                }).catch((error) => {
                    ukazChybu(error);
                });
            });
        }

        //*******************************************************
        //***** Zapasy ******************************************
        //*******************************************************
        let zapas_id; //id editovaneho zapasu
        function upravitZapas(id, datum, cas, misto, souper, skore) {
        }
        function dbNactiZapasy() {
            let url = `${HOST}/zapasy/`;
            fetch(url).then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    if (obj.error) {
                        document.getElementById("div_zapasy").innerHTML = obj.error;
                    } else {
                        let s = ``;
                        for (let z of obj.zapasy) {
                            s += `<a href="JavaScript:ukazZapas(${z.id})">`;
                            s += `${z.datum} ${z.souper} (${z.skore})`;
                            s += `</a><br>`;
                        }
                        document.getElementById("div_zapasy1").innerHTML = s;
                    }
                }).catch((error) => {
                    ukazChybu(error);
                });
            });
        }
        function dbPridejZapas() {
            let url = `${HOST}/zapasy/pridej?`;
            url += "&datum=";
            url += "&cas=";
            url += "&misto=";
            url += "&souper=";
            url += "&skore=";
            fetch(url).then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    if (obj.error) {
                        document.getElementById("div_zapasy").innerHTML = obj.error;
                    } else {
                        ukazZapas(obj.id);
                    }
                }).catch((error) => {
                    ukazChybu(error);
                });
            });
        }
        function dbUlozZapas() {
            let url = `${HOST}/zapasy/uloz?id=${zapas_id}`;
            url += "&datum="  + document.getElementById("datum").value;
            url += "&cas=" + document.getElementById("cas").value;
            url += "&misto=" + document.getElementById("misto").value;
            url += "&souper=" + document.getElementById("souper").value;
            url += "&skore=" + document.getElementById("skore").value;
            fetch(url).then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    if (obj.error) {
                        document.getElementById("div_hraci").innerHTML = obj.error;
                    } else {
                    }
                }).catch((error) => {
                    ukazChybu(error);
                });
            });
        }
        function dbNactiZapas() {
            let url = `${HOST}/zapasy/?id=${zapas_id}`;
            fetch(url).then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    if (obj.error) {
                        document.getElementById("div_zapasy").innerHTML = obj.error;
                    } else {
                        let zapas = obj.zapasy[0];
                        document.getElementById("datum").value = zapas.datum;
                        document.getElementById("cas").value = zapas.cas;
                        document.getElementById("misto").value = zapas.misto;
                        document.getElementById("souper").value = zapas.souper;
                        document.getElementById("skore").value = zapas.skore;
                    }
                }).catch((error) => {
                    ukazChybu(error);
                });
            });
            let url2 = `${HOST}/nominace/?zapas=${zapas_id}`;
            fetch(url2).then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    if (obj.error) {
                        document.getElementById("div_zapasy").innerHTML = obj.error;
                    } else {
                        let s = ``;
                        for (let st of obj.hraci) {
                            let checked = ``;
                            if (st.je_nominovan) {
                                checked = ` checked="checked" `;
                            }
                            s += `#${st.cislo_dresu} ${st.jmeno} ${st.prijmeni} (${st.rok_narozeni})`;
                            s += `<input type="checkbox" id="nominovan_${st.id}" ${checked} onchange="zmenNominaci(${st.id})">`;
                            s += ` G:<input type="number" id="goly_${st.id}" min="0" max="99" value="${st.goly}" onchange="zmenNominaci(${st.id})">`;
                            s += ` A:<input type="number" id="asistence_${st.id}" min="0" max="99" value="${st.asistence}" onchange="zmenNominaci(${st.id})">`;
                            s += `<br>`;
                        }
                        document.getElementById("div_nominace").innerHTML = s;
                    }
                }).catch((error) => {
                    ukazChybu(error);
                });
            });
        }
        function zmenNominaci(id) {
            let n = 0;
            if (document.getElementById("nominovan_"+id).checked) {
                n = 1;
            };
            let g = document.getElementById("goly_"+id).valueAsNumber;
            let a = document.getElementById("asistence_"+id).valueAsNumber;
            let url = `${HOST}/nominace/uloz?zapas=${zapas_id}&hrac=${id}&n=${n}&g=${g}&a=${a}`;
            fetch(url).then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    if (obj.error) {
                        document.getElementById("div_zapasy").innerHTML = obj.error;
                    } else {
                    }
                }).catch((error) => {
                    ukazChybu(error);
                });
            });

        }
        //*******************************************************
        function ukazTym() {
            document.getElementById("div_tym").style.display = "block";
            document.getElementById("div_zapasy").style.display = "none";
            document.getElementById("div_zapas").style.display = "none";
            dbNactiTym();
        }
        function ukazZapasy() {
            document.getElementById("div_tym").style.display = "none";
            document.getElementById("div_zapasy").style.display = "block";
            document.getElementById("div_zapas").style.display = "none";
            dbNactiZapasy();
        }
        function ukazZapas(id) {
            zapas_id = id;
            document.getElementById("div_tym").style.display = "none";
            document.getElementById("div_zapasy").style.display = "none";
            document.getElementById("div_zapas").style.display = "block";
            dbNactiZapas();
        }
        function spustPoNacteni() {
            ukazTym();
        }

    </script>
</head>
<body onload="spustPoNacteni()">

<div id="div_chyby" style="color: white; background-color: red; display: none"></div>

<!-- ***** Tym ***** -->
<div id="div_tym">
    <div style="position:fixed;right:40px;"><button style="alignment: right" onclick="ukazZapasy()">Zápasy</button></div>
    <h1>Tým</h1>

    #<input type="number" id="cislo_dresu" placeholder="dres" min="1" max="99">
    <input type="text" id="jmeno" placeholder="jméno">
    <input type="text" id="prijmeni" placeholder="příjmení">
    <input type="number" id="rok_narozeni" placeholder="narozen(a)" min="1900" max="2020">
    <input type="button" value="Uložit" onclick="dbUlozHrace()">
    <input type="button" value="Storno" onclick="stornoHrace()">
    <div id="div_hraci"></div>

</div>

<!-- ***** Zapasy ***** -->
<div id="div_zapasy">
    <div style="position:fixed;right:40px;">
        <button onclick="dbPridejZapas()">Přidat zápas</button>
        <button onclick="ukazTym()">zpět na Tým</button>
    </div>
    <h1>Zápasy</h1>
    <div id="div_zapasy1"></div>

</div>

<!-- ***** Zapas ***** -->
<div id="div_zapas">
    <div style="position:fixed;right:40px;"><button style="alignment: right" onclick="dbUlozZapas(); ukazZapasy()">zpět na Zápasy</button></div>
    <h1>Zápas</h1>

    Datum: <input type="text" id="datum" onchange="dbUlozZapas()"><br>
    Čas: <input type="text" id="cas" onchange="dbUlozZapas()"><br>
    Místo: <input type="text" id="misto" onchange="dbUlozZapas()"><br>
    Soupeř: <input type="text" id="souper" onchange="dbUlozZapas()"><br>
    Skore: <input type="text" id="skore" onchange="dbUlozZapas()"><br>
    <br>
    <h2>Nominace</h2>
    <div id="div_nominace"></div>

</div>

</body>
</html>
